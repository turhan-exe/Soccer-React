export const cronWatchdog = functions
  .region(REGION)
  .https.onRequest(async (req, res) => {
    const authz = (req.headers.authorization as string) || '';
    const token = authz.startsWith('Bearer ') ? authz.slice(7) : '';
    if (!SCHED_SECRET || token !== SCHED_SECRET) {
      res.status(401).send('unauthorized');
      return;
    }
    const day = todayTR();
    const snap = await db.doc(`ops_heartbeats/${day}`).get();
    const hb = snap.exists ? (snap.data() as any) : {};
    const problems: string[] = [];
    if (!hb.batchOk) problems.push('createDailyBatch Ã§alÄ±ÅŸmadÄ±');
    // If you require Unity job heartbeat, uncomment:
    // if (!hb.unityJobOk) problems.push('Unity job Ã§alÄ±ÅŸmadÄ±');
    if (problems.length) {
      await sendSlack(`ðŸš¨ Watchdog ${day} 19:10: ${problems.join(' â€¢ ')}`);
      return res.status(500).json({ ok: false, problems });
